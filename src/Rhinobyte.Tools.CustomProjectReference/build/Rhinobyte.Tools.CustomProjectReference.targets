<?xml version="1.0" encoding="utf-8"?>
<Project>

    <PropertyGroup>
        <IsMultiTargeted Condition="'$(TargetFrameworks)' != '' AND $(TargetFrameworks.IndexOf(';')) > -1 AND $(TargetFrameworks.IndexOf(';')) != $([MSBuild]::Add($(TargetFrameworks.Length), 1))">true</IsMultiTargeted>

        <_ProcessBeforeBuildRunOnlyOnce Condition=" '$(_ProcessBeforeBuildRunOnlyOnce)' == '' AND '$(IsMultiTargeted)' == 'true'">DispatchToInnerBuilds</_ProcessBeforeBuildRunOnlyOnce>
        <_ProcessBeforeBuildRunOnlyOnce Condition=" '$(_ProcessBeforeBuildRunOnlyOnce)' == '' AND '$(IsMultiTargeted)' != 'true'">BeforeBuild</_ProcessBeforeBuildRunOnlyOnce>

        <_ProcessCustomProjectReferencesBeforeTargets Condition=" '$(_ProcessCustomProjectReferencesBeforeTargets)' != '' ">$(_ProcessCustomProjectReferencesBeforeTargets);$(_ProcessBeforeBuildRunOnlyOnce)</_ProcessCustomProjectReferencesBeforeTargets>
        <_ProcessCustomProjectReferencesBeforeTargets Condition=" '$(_ProcessCustomProjectReferencesBeforeTargets)' == '' ">$(_ProcessBeforeBuildRunOnlyOnce)</_ProcessCustomProjectReferencesBeforeTargets>

        <AssignTargetPathsDependsOn Condition="'$(AssignTargetPathsDependsOn)' != ''">
            $(AssignTargetPathsDependsOn);
            _ProcessCustomProjectReferences;
        </AssignTargetPathsDependsOn>
        <AssignTargetPathsDependsOn Condition="'$(AssignTargetPathsDependsOn)' == ''">_ProcessCustomProjectReferences</AssignTargetPathsDependsOn>
    </PropertyGroup>
    
    <Target Name="_ProcessCustomProjectReferences"
            BeforeTargets="$(_ProcessCustomProjectReferencesBeforeTargets)"
            DependsOnTargets="$(_ProcessCustomProjectReferencesDependsOnTargets)"
            
    >
        <Message Importance="high" Text="
  !! _ProcessCustomProjectReferences !!

MSBuildVersion:        $(MSBuildVersion)
MSBuildToolsVersion:   $(MSBuildToolsVersion)

IsMultiTargeted:  $(IsMultiTargeted)
IsInnerBuild:     $(IsInnerBuild)
IsCrossTargeted2: $(IsCrossTargeted2)

_ProcessBeforeBuildRunOnlyOnce:                  $(_ProcessBeforeBuildRunOnlyOnce)
_ProcessCustomProjectReferencesBeforeTargets:       $(_ProcessCustomProjectReferencesBeforeTargets)
_ProcessCustomProjectReferencesDependsOnTargets:    $(_ProcessCustomProjectReferencesDependsOnTargets)

TargetFrameworkValues:      '$(TargetFrameworkValues)'
TargetFrameworksValues:      '$(TargetFrameworksValues)'

CustomProjectReferences:
@(CustomProjectReferences, '%0a')" />
    </Target>
</Project>